var admintools_scan_ajax_url_start="";var admintools_scan_ajax_url_step="";var admintools_scan_error_callback=scan_dummy_error_handler;var admintools_scan_msg_ago="";var admintools_scan_timerid=-1;var admintools_scan_responseago=0;function scan_dummy_error_handler(a){alert(a);window.location="index.php?option=com_admintools&view=Scans"}function doScanAjax(d,a,c){var b={type:"GET",url:d,cache:false,timeout:600000,success:function(j){var i=null;var g="";var e=j.indexOf("###");if(e==-1){j="Invalid AJAX data: "+j;if(c==null){if(admintools_scan_error_callback!=null){admintools_scan_error_callback(j)}}else{c(j)}return}else{if(e!=0){g=j.substr(e)}else{g=j}}g=g.substr(3);e=g.lastIndexOf("###");g=g.substr(0,e);try{var h=JSON.parse(g)}catch(f){j=f.message+"\n<br/>\n<pre>\n"+g+"\n</pre>";if(c==null){if(admintools_scan_error_callback!=null){admintools_scan_error_callback(j)}}else{c(j)}return}a(h)},error:function(e,h,g){var f="<strong>AJAX Loading Error</strong><br/>HTTP Status: "+e.status+" ("+e.statusText+")<br/>";f=f+"Internal status: "+h+"<br/>";f=f+"XHR ReadyState: "+e.readyState+"<br/>";f=f+"Raw server response:<br/>"+e.responseText;if(c==null){if(admintools_scan_error_callback!=null){admintools_scan_error_callback(f)}}else{c(f)}}};akeeba.jQuery.ajax(b)}function startScan(){admintools.Modal.open({inherit:"#admintools-scan-dim",width:"360px",height:"210px",hideClose:true,lock:true});doScanAjax(admintools_scan_ajax_url_start,function(a){processScanStep(a)})}function processScanStep(a){stop_scan_timer();if(a.status==false){admintools_scan_error_callback(a.error)}else{if(a.done){window.location="index.php?option=com_admintools&view=Scans"}else{start_scan_timer();doScanAjax(admintools_scan_ajax_url_step,function(b){processScanStep(b)})}}}function start_scan_timer(){if(admintools_scan_timerid>=0){window.clearInterval(admintools_scan_timerid)}admintools_scan_responseago=0;set_scan_timermsg();admintools_scan_timerid=window.setInterval("step_scan_timer()",1000)}function step_scan_timer(){admintools_scan_responseago++;set_scan_timermsg()}function stop_scan_timer(){if(admintools_scan_timerid>=0){window.clearInterval(admintools_scan_timerid)}}function set_scan_timermsg(){document.getElementById("admintools-lastupdate-text").innerHTML=admintools_scan_msg_ago.replace("%s",admintools_scan_responseago)};